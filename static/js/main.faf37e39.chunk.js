(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(t,e,n){t.exports=n(211)},110:function(t,e,n){},182:function(t,e){},184:function(t,e){},204:function(t,e,n){},211:function(t,e,n){"use strict";n.r(e);var a=n(3),o=n.n(a),s=n(86),i=n.n(s),r=n(46),c=n(47),p=n(49),u=n(48),l=n(50),d=n(87),y=n(44),h=n(41),m=n.n(h),f=n(98),b=[{constant:!0,inputs:[],name:"lastDrawingId",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"x",type:"uint32[]"},{name:"y",type:"uint32[]"},{name:"p",type:"bool[]"}],name:"drawLines",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[],name:"resetDrawing",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"startDrawingId",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!1,name:"",type:"bytes32"},{indexed:!1,name:"x",type:"uint32[]"},{indexed:!1,name:"y",type:"uint32[]"},{indexed:!1,name:"p",type:"bool[]"}],name:"DrawLines",type:"event"}];n(110);function v(){var t=Object(d.a)(["\nquery allPosts {\n  lineSets(last: 20) {\n    id\n    x\n    y\n    p\n  }\n}\n"]);return v=function(){return t},t}var w=m()(v());function x(t){var e=parseInt(t);return e<0?0:e>1e3?1e3:e}var k=function(t){function e(){var t,n;Object(r.a)(this,e);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(p.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(o)))).delete=function(t){t.preventDefault(),n.props.delete(n.props.index)},n}return Object(l.a)(e,t),Object(c.a)(e,[{key:"render",value:function(){return o.a.createElement("line",Object.assign({onClick:this.delete},this.props))}}]),e}(a.Component),g=function(t){function e(){var t,n;Object(r.a)(this,e);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(p.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(o)))).state={startNode:null},n.escFunction=function(t){27===t.keyCode&&n.setState({startNode:null})},n.startPoint=function(){if(n.state.startNode){var t={x1:n.state.startNode.x,x2:n.props.position.x,y1:n.state.startNode.y,y2:n.props.position.y};return n.setState({startNode:null}),void n.props.addTempNode(t)}n.setState({startNode:n.props.position})},n.removeNode=function(t){},n}return Object(l.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.escFunction,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.escFunction,!1)}},{key:"render",value:function(){var t=this;return o.a.createElement("svg",{className:"canvas",onClick:this.startPoint,style:{width:"800px",height:"600px"}},this.props.data.lineSets.map(function(t){return function(t){for(var e=0,n=0,a=[];++e<t.x.length;)a.push({fromX:x(t.x[n]),toX:x(t.x[e]),fromY:x(t.y[n]),toY:x(t.y[e]),on:t.p[e]}),n=e;return a}(t).map(function(e,n){return o.a.createElement("line",{key:"".concat(t.id,"-").concat(n),x1:e.fromX,y1:e.fromY,x2:e.toX,y2:e.toY,style:{stroke:"blue",strokeWidth:3}})})}),this.state.startNode&&o.a.createElement("line",{key:"start",x1:this.state.startNode.x,x2:this.props.position.x,y1:this.state.startNode.y,y2:this.props.position.y,style:{stroke:"red",strokeWidth:3}}),this.props.tempNodes.map(function(e,n){return o.a.createElement(k,{delete:t.removeNode,index:n,key:"temp".concat(n),x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2,style:{stroke:"green",strokeWidth:3}})}))}}]),e}(a.Component),N=function(t){function e(){var t,n;Object(r.a)(this,e);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(n=Object(p.a)(this,(t=Object(u.a)(e)).call.apply(t,[this].concat(o)))).state={nodes:[]},n.addTempNode=function(t){n.setState({nodes:n.state.nodes.concat(t)})},n.start=function(t){t.preventDefault();var e=window.web3.eth.contract(b).at("0x21B1dDc150bF8589f3200BeAff1bFD8e77b201D5"),a=[],o=[],s=[];n.state.nodes.forEach(function(t){console.log("has ndoe",t),a.push(t.x1),a.push(t.x2),o.push(t.y1),o.push(t.y2),s.push(!0),s.push(!0)}),window.web3.eth.getAccounts(function(t,i){if(t)throw t;e.drawLines.sendTransaction(a,o,s,{from:i[0]},function(t,e){n.setState({nodes:[]}),console.log(t,e),n.props.data.refetch()})})},n.startPoint=function(t){},n}return Object(l.a)(e,t),Object(c.a)(e,[{key:"componentDidMount",value:function(){this.props.data.startPolling(4e3)}},{key:"render",value:function(){return o.a.createElement("div",{className:"App"},o.a.createElement("h1",null,"EthaSketch"),o.a.createElement("div",null,this.props.data.loading?o.a.createElement("span",null,"loading"):o.a.createElement(f.a,null,o.a.createElement(g,{addTempNode:this.addTempNode,tempNodes:this.state.nodes,data:this.props.data}))),o.a.createElement("button",{class:"go",onClick:this.start},"Sketch on Blockchain"))}}]),e}(a.Component),E=Object(y.graphql)(w)(N),j=n(94),O=n.n(j),D=n(95),S=n.n(D),F=n(97),A=(n(204),n(205),new F.a({uri:"https://api.thegraph.com/subgraphs/name/iainnash/plotterlinewriter"})),C=new O.a("pk_test_F69F68D2FD22535B");window.web3=new S.a(C.getProvider()),i.a.render(o.a.createElement(y.ApolloProvider,{client:A},o.a.createElement(E,null)),document.getElementById("root"))}},[[100,1,2]]]);
//# sourceMappingURL=main.faf37e39.chunk.js.map